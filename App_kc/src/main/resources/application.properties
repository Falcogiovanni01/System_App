spring.application.name=App_KC
server.port=8090

# ==============================================================
# 1. CONFIGURAZIONE OAUTH2 CLIENT (Login via Keycloak)
# ==============================================================
spring.security.oauth2.client.registration.keycloak.client-id=mensa-backend
spring.security.oauth2.client.registration.keycloak.client-secret=${KEYCLOACK_CLIENT_SECRET}

# URI INTERNE (Spring Boot -> Keycloak)
keycloak.token-uri=http://mensa-keycloak:8080/realms/mensa/protocol/openid-connect/token
keycloak.user-info-uri=http://mensa-keycloak:8080/realms/mensa/protocol/openid-connect/userinfo
keycloak.jwk-set-uri=http://mensa-keycloak:8080/realms/mensa/protocol/openid-connect/certs

# URI ESTERNE (Browser -> Nginx -> Keycloak)
keycloak.auth-uri=https://localhost:8443/realms/mensa/protocol/openid-connect/auth

# Dati del Client che hai creato su Keycloak
server.forward-headers-strategy=framework
# Gestione corretta degli header del proxy

server.use-forward-headers=true

# Configurazione della sessione + # Obbliga l'invio del cookie solo su HTTPS (protegge da sniffing)

server.servlet.session.cookie.secure=true
#server.servlet.session.cookie.same-site=lax

# Impedisce l'invio del cookie in richieste cross-site (protegge da CSRF)
server.servlet.session.cookie.same-site=strict
# ==============================================================
# 2. CONFIGURAZIONE MONGODB
# ==============================================================

# Per ora lasciamo la password in chiaro (come nel docker-compose).
# Più avanti la sposteremo anche questa in Vault.
spring.data.mongodb.uri=mongodb://root:${MONGO_INITDB_ROOT_PASSWORD}@mensa-mongodb:27017/mensa_db?authSource=admin
spring.data.mongodb.database=mensa_db

# ==============================================================
# 3. LOGGING
# ==============================================================
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.oauth2=DEBUG
logging.level.org.springframework.web=DEBUG

# ==============================================================
# 4. CONFIGURAZIONE VAULT
# ==============================================================

# Abilita l’import dei config da Vault
spring.config.import=vault://

# Autenticazione (usiamo il token passato come variabile d'ambiente VAULT_TOKEN)
spring.cloud.vault.authentication=TOKEN
spring.cloud.vault.token=${VAULT_TOKEN}
spring.cloud.vault.scheme=http
spring.cloud.vault.host=localhost
spring.cloud.vault.port=8200

# Configurazione KV (Key-Value) engine
# Engine: App_KC
# Secret: App_KC
# -> Path completo in Vault: App_KC/App_KC
spring.cloud.vault.kv.enabled=true
spring.cloud.vault.kv.backend=secret
spring.cloud.vault.kv.default-context=App_KC

# Variabile di prova (rimane com'è)
app.secret=${APP_SECRET}


# --- SECURITY HARDENING: SESSION MANAGEMENT (NIST SC-23) ---

# Rende il cookie inaccessibile via JavaScript (protegge da XSS)
server.servlet.session.cookie.http-only=true

# Obbliga l'invio del cookie solo su HTTPS (protegge da sniffing)



# Timeout della sessione (es. 30 minuti) per NIST AC-12
server.servlet.session.timeout=30m