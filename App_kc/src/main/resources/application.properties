spring.application.name=App_KC
server.port=8090

# ==============================================================
# 1. CONFIGURAZIONE OAUTH2 CLIENT (Login via Keycloak)
# ==============================================================
spring.security.oauth2.client.registration.keycloak.client-id=mensa-backend
spring.security.oauth2.client.registration.keycloak.client-secret=${KEYCLOACK_CLIENT_SECRET}

# Dati del Client che hai creato su Keycloak

#
# # 1. Authorization URI: È l'indirizzo che il BROWSER dell'utente deve visitare.
# # Deve essere 'localhost' (o il tuo dominio pubblico) perché il browser non conosce 'keycloak:8080'.
# spring.security.oauth2.client.provider.keycloak.authorization-uri=http://localhost/realms/mensa/protocol/openid-connect/auth

# # 2. Token URI: È l'indirizzo che SPRING BOOT (backend) usa per scambiare il codice con il token.
# # Deve essere 'keycloak:8080' perché comunica dentro la rete Docker.
# spring.security.oauth2.client.provider.keycloak.token-uri=http://keycloak:8080/realms/mensa/protocol/openid-connect/token

# # 3. User Info URI: Anche questo è backend-to-backend.
# spring.security.oauth2.client.provider.keycloak.user-info-uri=http://keycloak:8080/realms/mensa/protocol/openid-connect/userinfo

# # 4. JWK Set URI: Serve a Spring per scaricare le chiavi pubbliche e validare il token.
# spring.security.oauth2.client.provider.keycloak.jwk-set-uri=http://keycloak:8080/realms/mensa/protocol/openid-connect/certs

# # 5. User Name Attribute: Campo da usare come "username" (es. preferred_username)
# spring.security.oauth2.client.provider.keycloak.user-name-attribute=preferred_username

# ==============================================================
# 2. CONFIGURAZIONE MONGODB
# ==============================================================

# Per ora lasciamo la password in chiaro (come nel docker-compose).
# Più avanti la sposteremo anche questa in Vault.
spring.data.mongodb.uri=mongodb://root:${MONGO_INITDB_ROOT_PASSWORD}@localhost:27017/mensa_db?authSource=admin
spring.data.mongodb.database=mensa_db

# ==============================================================
# 3. LOGGING
# ==============================================================
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.oauth2=DEBUG
logging.level.org.springframework.web=DEBUG

# ==============================================================
# 4. CONFIGURAZIONE VAULT
# ==============================================================

# Abilita l’import dei config da Vault
spring.config.import=vault://

# Autenticazione (usiamo il token passato come variabile d'ambiente VAULT_TOKEN)
spring.cloud.vault.authentication=TOKEN
spring.cloud.vault.token=${VAULT_TOKEN}
spring.cloud.vault.scheme=http
spring.cloud.vault.host=localhost
spring.cloud.vault.port=8200

# Configurazione KV (Key-Value) engine
# Engine: App_KC
# Secret: App_KC
# -> Path completo in Vault: App_KC/App_KC
spring.cloud.vault.kv.enabled=true
spring.cloud.vault.kv.backend=secret
spring.cloud.vault.kv.default-context=App_KC

# Variabile di prova (rimane com'è)
app.secret=${APP_SECRET}
