spring.application.name=App_KC
server.port=8090

# ==============================================================
# 1. CONFIGURAZIONE OAUTH2 CLIENT (Login via Keycloak)
# ==============================================================

# Dati del Client che hai creato su Keycloak
spring.security.oauth2.client.registration.keycloak.client-id=mensa-backend

# Il Client Secret viene letto da Vault (chiave: KEYCLOAK_CLIENT_SECRET)
spring.security.oauth2.client.registration.keycloak.client-secret=${KEYCLOACK_CLIENT_SECRET}
spring.security.oauth2.client.registration.keycloak.scope=openid,profile,email,roles
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

# Dati del Provider (il server Keycloak)
#spring.security.oauth2.client.provider.keycloak.issuer-uri=http://localhost:8080/realms/mensa
spring.security.oauth2.client.provider.keycloak.issuer-uri=http://localhost/realms/mensa

spring.security.oauth2.client.provider.keycloak.user-name-attribute=preferred_username

# ==============================================================
# 2. CONFIGURAZIONE MONGODB
# ==============================================================

# Per ora lasciamo la password in chiaro (come nel docker-compose).
# Più avanti la sposteremo anche questa in Vault.
spring.data.mongodb.uri=mongodb://root:${MONGO_INITDB_ROOT_PASSWORD}@localhost:27017/mensa_db?authSource=admin
spring.data.mongodb.database=mensa_db

# ==============================================================
# 3. LOGGING
# ==============================================================
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.security.oauth2=DEBUG
logging.level.org.springframework.web=DEBUG

# ==============================================================
# 4. CONFIGURAZIONE VAULT
# ==============================================================

# Abilita l’import dei config da Vault
spring.config.import=vault://

# Autenticazione (usiamo il token passato come variabile d'ambiente VAULT_TOKEN)
spring.cloud.vault.authentication=TOKEN
spring.cloud.vault.token=${VAULT_TOKEN}
spring.cloud.vault.scheme=http
spring.cloud.vault.host=localhost
spring.cloud.vault.port=8200

# Configurazione KV (Key-Value) engine
# Engine: App_KC
# Secret: App_KC
# -> Path completo in Vault: App_KC/App_KC
spring.cloud.vault.kv.enabled=true
spring.cloud.vault.kv.backend=secret
spring.cloud.vault.kv.default-context=App_KC

# Variabile di prova (rimane com'è)
app.secret=${APP_SECRET:ValoreDiDefaultSeVaultFallisce}
